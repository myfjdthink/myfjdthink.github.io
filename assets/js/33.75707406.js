(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{475:function(s,a,t){s.exports=t.p+"assets/img/-1537959979248.4a622c72.png"},476:function(s,a,t){s.exports=t.p+"assets/img/-1538033991774.355a0851.png"},630:function(s,a,t){"use strict";t.r(a);var n=t(2),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"api-接口与-typescript-interface"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#api-接口与-typescript-interface"}},[s._v("#")]),s._v(" API 接口与 Typescript Interface")]),s._v(" "),a("h2",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),a("p",[s._v("Interface 就是接口，在 typescript 用于类型限定。")]),s._v(" "),a("p",[s._v("在 Node 项目中，我们常用 apidoc 来定义接口文档。")]),s._v(" "),a("p",[s._v("那么，他们俩是否能结合起来呢？")]),s._v(" "),a("h2",{attrs:{id:"apidoc-的痛点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#apidoc-的痛点"}},[s._v("#")]),s._v(" apidoc 的痛点")]),s._v(" "),a("p",[a("a",{attrs:{href:"http://apidocjs.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("apidoc"),a("OutboundLink")],1),s._v(" Inline Documentation for RESTful web APIs，使用起来非常方便，直接在 api 上添加注释，就可以生成可视化的文档。")]),s._v(" "),a("p",[s._v("但是，在实际业务中，我们有些接口比较复杂，定义返回值是一件比较痛苦的事情，如图：")]),s._v(" "),a("p",[a("img",{attrs:{src:t(475),alt:"-1537959979248.png"}})]),s._v(" "),a("p",[s._v("而且，过了一段时间之后，出于惰性，开发人员会放弃更新 API 文档，导致文档落后于实际。")]),s._v(" "),a("h2",{attrs:{id:"api-interface"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#api-interface"}},[s._v("#")]),s._v(" API Interface")]),s._v(" "),a("h3",{attrs:{id:"api-未定义的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#api-未定义的问题"}},[s._v("#")]),s._v(" API 未定义的问题")]),s._v(" "),a("p",[s._v("在 js 项目中，api 返回结构一般是无法清晰地看出来的，你得跑一下接口，才知道会返回什么，或者仔细看一遍代码。这种情况下，开发人员维护 API 会面临以下问题：")]),s._v(" "),a("ul",[a("li",[s._v("文档缺失：接口文档缺少对某个字段的定义，不知道该字段作何用处")]),s._v(" "),a("li",[s._v("字段混乱：明明是一个字段，可能在 接口 A 是叫 amount， 在接口 B 却叫 number")]),s._v(" "),a("li",[s._v("重复定义：多个接口中都用到一个叫 Banner 的东西，需要在每个接口文档中定义一遍，稍有改动，需要更改多处")])]),s._v(" "),a("h3",{attrs:{id:"使用-interface-的好处"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-interface-的好处"}},[s._v("#")]),s._v(" 使用 interface 的好处")]),s._v(" "),a("p",[s._v("所以可以尝试使用 typescript 的 interface 来定义 API 的返回值结构，一个接口对应一个 interface。")]),s._v(" "),a("p",[a("img",{attrs:{src:t(476),alt:"-1538033991774.png"}})]),s._v(" "),a("p",[s._v("假设一个 api 是 product info ，定义结构如下：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n * 产品明细\n */")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IProductInfo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n   * 基础利息\n   */")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("baseRate")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" number\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n   * 加息\n   */")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("bonusRate")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" number\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n   * 加息提示\n   */")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("bonusRateStr")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" string\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("另一个 api 是 product list ，可以很方便地进行复用：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n * 产品列表\n */")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IProductList")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("list")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Array"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("IProductInfo"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("这些接口定义也可以共享给前端（前端也用 typescript 的话）")]),s._v(" "),a("h2",{attrs:{id:"apidoc-interface"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#apidoc-interface"}},[s._v("#")]),s._v(" apidoc + interface")]),s._v(" "),a("p",[s._v("很多时候，你的痛点其实也是其他人的痛点，所以就有了开源项目，通过搜寻，我们可以找到一个 apidoc 的插件 "),a("a",{attrs:{href:"https://github.com/tgreyjs/apidoc-plugin-ts",target:"_blank",rel:"noopener noreferrer"}},[s._v("apidoc-plugin-ts"),a("OutboundLink")],1),s._v("，这个插件可以根据 interface 的定义帮你生成 apidoc 需要的 @apiSuccess 内容。")]),s._v(" "),a("p",[s._v("定义一个接口：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("filename")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("employers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ts\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Employer")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n   * Employer job title\n   */")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("jobTitle")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n   * Employer personal details\n   */")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("personalDetails")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("age")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" number"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("引入 interface:")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v(" @"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apiInterface")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("employers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("Person"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("翻译的效果:")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v(" @apiSuccess "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" jobTitle Job title\n @apiSuccess "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("Object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" personalDetails Empoyer personal details\n @apiSuccess "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" personalDetails"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name\n @apiSuccess "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("Number"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" personalDetails"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("age\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("还支持数组结构定义呢~")]),s._v(" "),a("p",[s._v("有了这个插件，就可以通过维护 interface 来维护 apidoc 了。")]),s._v(" "),a("h3",{attrs:{id:"注意"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注意"}},[s._v("#")]),s._v(" 注意：")]),s._v(" "),a("p",[s._v("该插件不支持匿名接口定义数组结构， 如下：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IProductList")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("list")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Array"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("a")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("b")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" string\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("AST 解析代码的时候会拿不到某些属性，会报错")])])}),[],!1,null,null,null);a.default=e.exports}}]);