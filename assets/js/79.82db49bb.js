(window.webpackJsonp=window.webpackJsonp||[]).push([[79],{649:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"场景-问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#场景-问题"}},[s._v("#")]),s._v(" 场景+问题")]),s._v(" "),t("p",[s._v("新增某个指标的时候，需要使用 Spark Doris Connector 写入大量数据（600w+）到 Doris，默认配置下会碰到以下错误：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('Streamload Response Error2 :status: 200, resp msg: OK, resp content: {    \n\\"TxnId\\": 277044,    \\"Label\\": \\"spark_streamload_20220719_084617_a0cce08e8ce740a9adefa8ffb2a63a09\\",    \n\\"TwoPhaseCommit\\": \\"false\\",    \\"Status\\": \\"Fail\\",    \n\\"Message\\": \\"tablet writer write failed, tablet_id=10001248, txn_id=277044, \nerr=-235, host: 10.201.15.216\\",    \\"NumberTotalRows\\": 0,    \\"NumberLoadedRows\\": 0,    \\"NumberFilteredRows\\": 0,    \n\\"NumberUnselectedRows\\": 0,    \\"LoadBytes\\": 785485,    \\"LoadTimeMs\\": 54,    \\"BeginTxnTimeMs\\": 0,    \n\\"StreamLoadPutTimeMs\\": 0,    \\"ReadDataTimeMs\\": 0,    \\"WriteDataTimeMs\\": 52,    \\"CommitAndPublishTimeMs\\": 0}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("关键信息：")]),s._v(" "),t("p",[s._v("tablet writer write failed， err=-235")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://doris.apache.org/zh-CN/docs/faq/data-faq.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("文档"),t("OutboundLink")],1),s._v("解释是")]),s._v(" "),t("blockquote",[t("p",[s._v("这个错误通常发生在数据导入操作中。新版错误码为 -235，老版本错误码可能是 -215。这个错误的含义是，对应tablet的数据版本超过了最大限制（默认500，由 BE 参数 max_tablet_version_num 控制），后续写入将被拒绝。比如问题中这个错误，即表示 27306172 这个tablet的数据版本超过了限制。")])]),s._v(" "),t("p",[s._v("就是导入太频繁了，doris be 忙不过来")]),s._v(" "),t("h2",{attrs:{id:"解决方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解决方案"}},[s._v("#")]),s._v(" 解决方案")]),s._v(" "),t("p",[s._v("在写入代码中调整写入的批次数，减少写入批次")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("spark_df"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("write"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("format")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"doris"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \\\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("option"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"doris.table.identifier"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'table_name'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \\\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("option"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"doris.fenodes"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'doris_fenodes'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \\\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("option"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sink.batch.size"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \\\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("option"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sink.max-retries"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \\\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("option"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" doris_user"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \\\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("option"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"password"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" doris_password"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("save"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("将默认的 "),t("em",[s._v("sink.batch.size")]),s._v(" 1w 改为 3w，并设置了失败重试次数为 4，这样就可以顺利写入数据了")]),s._v(" "),t("p",[s._v("更多配置信息参考"),t("a",{attrs:{href:"https://doris.apache.org/zh-CN/docs/ecosystem/spark-doris-connector.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("spark doris docs"),t("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=e.exports}}]);