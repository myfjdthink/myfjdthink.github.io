(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{532:function(s,a,e){s.exports=e.p+"assets/img/dataproc_logs.d23322ed.png"},533:function(s,a,e){s.exports=e.p+"assets/img/logging_page.cd740082.png"},534:function(s,a,e){s.exports=e.p+"assets/img/dataproc_logs_setting.90c04b13.png"},648:function(s,a,e){"use strict";e.r(a);var t=e(2),r=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("在 Dataproc 部署了 Spark 集群后，我们可以通过 gcloud 命令来 submit spark job，gcloud 会以流式的方式返回 spark driver logs，那要如何看到 executor 的 logs 呢？")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("gcloud dataproc "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("jobs")]),s._v(" submit job-command "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --cluster"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cluster-name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --region"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("region "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    other dataproc-flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -- job-args\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("一开始我想着是进入 Dataproc 集群的 Spark History Server 上进行查看，但是也不太方便，其实有个更简单的办法，在集群的顶部菜单中，右上角有一个查看日志的入口")]),s._v(" "),a("p",[a("img",{attrs:{src:e(532),alt:"img.png"}})]),s._v(" "),a("p",[s._v("点击进去后，我们可以看到很多服务的日志，Google 已经把这些日志都集成好了。页面跳转后，会默认执行以下查询")]),s._v(" "),a("div",{staticClass:"language-config line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('resource.type="cloud_dataproc_cluster"\nresource.labels.cluster_name="xxxx"\nresource.labels.cluster_uuid="ffe84392-4012-4a4a-ac81-c3e513a9cdf0"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("界面")]),s._v(" "),a("p",[a("img",{attrs:{src:e(533),alt:"img.png"}})]),s._v(" "),a("p",[s._v("该查询的作用是把 cloud_dataproc_cluster 服务的 xxxx cluster 集群的日志查询出来，我们再进一步过滤")]),s._v(" "),a("p",[s._v("查询 dataproc "),a("a",{attrs:{href:"https://cloud.google.com/dataproc/docs/guides/dataproc-job-output#spark_executor_logs",target:"_blank",rel:"noopener noreferrer"}},[s._v("文档"),a("OutboundLink")],1),s._v(" 可以知道，executor 的 logs 存储位于 yarn-userlogs")]),s._v(" "),a("p",[a("img",{attrs:{src:e(534),alt:"img.png"}})]),s._v(" "),a("p",[s._v("所以我们在日志查询系统里再补充 log_name 过滤条件")]),s._v(" "),a("div",{staticClass:"language-config line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('resource.type="cloud_dataproc_cluster"\nresource.labels.cluster_name="xxxx"\nresource.labels.cluster_uuid="ffe84392-4012-4a4a-ac81-c3e513a9cdf0"\nlog_name="projects/xxxproject/logs/yarn-userlogs"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("这样就要可以看到所有 job 的 executor logs 了。")]),s._v(" "),a("p",[s._v("我们也可以继续做过滤，例如过滤单个 job 的 logs，通过 application name 过滤.")]),s._v(" "),a("p",[s._v("note: application 在 gloud submit job 后会打印在命令行中")]),s._v(" "),a("div",{staticClass:"language-config line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('resource.type="cloud_dataproc_cluster"\nresource.labels.cluster_name="internal-16-60-07-19"\nresource.labels.cluster_uuid="ffe84392-4012-4a4a-ac81-c3e513a9cdf0"\nlog_name="projects/xxxproject/logs/yarn-userlogs"\njsonPayload.application="application_1658199041103_0098"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])])}),[],!1,null,null,null);a.default=r.exports}}]);