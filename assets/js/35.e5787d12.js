(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{536:function(t,r,a){t.exports=a.p+"assets/img/doris_architecture.59d52fc7.png"},537:function(t,r,a){t.exports=a.p+"assets/img/doris_mpp.cad74ca3.png"},651:function(t,r,a){"use strict";a.r(r);var e=a(2),s=Object(e.a)({},(function(){var t=this,r=t._self._c;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h1",{attrs:{id:"目录"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#目录"}},[t._v("#")]),t._v(" 目录")]),t._v(" "),r("p"),r("div",{staticClass:"table-of-contents"},[r("ul",[r("li",[r("a",{attrs:{href:"#架构"}},[t._v("架构")]),r("ul",[r("li",[r("a",{attrs:{href:"#fe-be-分离"}},[t._v("FE BE 分离")])]),r("li",[r("a",{attrs:{href:"#存储模型"}},[t._v("存储模型")])]),r("li",[r("a",{attrs:{href:"#查询引擎-mpp-and-向量化"}},[t._v("查询引擎 MPP And 向量化")])])])]),r("li",[r("a",{attrs:{href:"#表设计"}},[t._v("表设计")]),r("ul",[r("li",[r("a",{attrs:{href:"#partition-bucket-tablet"}},[t._v("Partition Bucket & Tablet")])]),r("li",[r("a",{attrs:{href:"#参考资料"}},[t._v("参考资料")])])])]),r("li",[r("a",{attrs:{href:"#字段设计"}},[t._v("字段设计")])]),r("li",[r("a",{attrs:{href:"#load-数据"}},[t._v("Load 数据")])]),r("li",[r("a",{attrs:{href:"#索引"}},[t._v("索引")]),r("ul",[r("li",[r("a",{attrs:{href:"#前缀索引"}},[t._v("前缀索引")])]),r("li",[r("a",{attrs:{href:"#bloomfilter-索引"}},[t._v("BloomFilter 索引")])]),r("li",[r("a",{attrs:{href:"#bitmap-索引"}},[t._v("Bitmap 索引")])]),r("li",[r("a",{attrs:{href:"#rollup"}},[t._v("Rollup")])])])]),r("li",[r("a",{attrs:{href:"#profile"}},[t._v("Profile")]),r("ul",[r("li",[r("a",{attrs:{href:"#explain-查询计划"}},[t._v("Explain 查询计划")])]),r("li",[r("a",{attrs:{href:"#profile-记录分析"}},[t._v("Profile 记录分析")])])])]),r("li",[r("a",{attrs:{href:"#缓存"}},[t._v("缓存")]),r("ul",[r("li",[r("a",{attrs:{href:"#分区缓存"}},[t._v("分区缓存")])])])]),r("li",[r("a",{attrs:{href:"#其他"}},[t._v("其他")]),r("ul",[r("li",[r("a",{attrs:{href:"#doris-官方-apache-doris-性能优化原理篇"}},[t._v("Doris 官方：Apache Doris 性能优化原理篇")])])])])])]),r("p"),t._v(" "),r("h2",{attrs:{id:"架构"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#架构"}},[t._v("#")]),t._v(" 架构")]),t._v(" "),r("h3",{attrs:{id:"fe-be-分离"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#fe-be-分离"}},[t._v("#")]),t._v(" FE BE 分离")]),t._v(" "),r("ul",[r("li",[t._v("采用 MySQ L 协议")]),t._v(" "),r("li",[t._v("采用列式存储，按列进行数据的编码压缩和读取")])]),t._v(" "),r("p",[r("img",{attrs:{src:a(536),alt:"doris_architecture.png"}})]),t._v(" "),r("h3",{attrs:{id:"存储模型"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#存储模型"}},[t._v("#")]),t._v(" 存储模型")]),t._v(" "),r("p",[t._v("Doris 支持多种存储模型，针对不同的场景做了针对性的优化：")]),t._v(" "),r("ul",[r("li",[t._v("Aggregate Key 模型：相同 Key 的 Value 列合并，通过提前聚合大幅提升性能")]),t._v(" "),r("li",[t._v("Unique Key 模型：Key 唯一，相同 Key 的数据覆盖，实现行级别数据更新")]),t._v(" "),r("li",[t._v("Duplicate Key 模型：明细数据模型，满足事实表的明细存储")])]),t._v(" "),r("h3",{attrs:{id:"查询引擎-mpp-and-向量化"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#查询引擎-mpp-and-向量化"}},[t._v("#")]),t._v(" 查询引擎 MPP And 向量化")]),t._v(" "),r("p",[t._v("节点间和节点内都并行执行，也支持多个大表的分布式 Shuffle Join，从而能够更好应对复杂查询。")]),t._v(" "),r("p",[r("img",{attrs:{src:a(537),alt:"doris_mpp.png"}})]),t._v(" "),r("p",[t._v("Doris 查询引擎是向量化的查询引擎")]),t._v(" "),r("p",[t._v("向量化:批处理(列存)>逐行(行存)，充分使用计算能力")]),t._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/148621151",target:"_blank",rel:"noopener noreferrer"}},[t._v("5分钟了解MPP数据库"),r("OutboundLink")],1)]),t._v(" "),r("li",[r("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/100933389",target:"_blank",rel:"noopener noreferrer"}},[t._v("数据库计算引擎的优化技术"),r("OutboundLink")],1)]),t._v(" "),r("li",[r("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/55327037",target:"_blank",rel:"noopener noreferrer"}},[t._v("SIMD简介"),r("OutboundLink")],1)])]),t._v(" "),r("h2",{attrs:{id:"表设计"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#表设计"}},[t._v("#")]),t._v(" 表设计")]),t._v(" "),r("h3",{attrs:{id:"partition-bucket-tablet"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#partition-bucket-tablet"}},[t._v("#")]),t._v(" Partition Bucket & Tablet")]),t._v(" "),r("p",[t._v("Tablet :在 Doris 的存储引擎中，用户数据被水平划分为若干个数据分片（Tablet，也称作数据分桶）")]),t._v(" "),r("p",[t._v("一个表的 Tablet 总数量等于 (Partition num * Bucket num)，单个 Tablet 的数据量理论上没有上下界，但建议在 1G - 10G 的范围内。")]),t._v(" "),r("p",[t._v("小表不需要 Partition，可以只分 Bucket")]),t._v(" "),r("p",[t._v("一般按日期 Partition，要了解动态分区的用法")]),t._v(" "),r("h3",{attrs:{id:"参考资料"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://doris.apache.org/zh-CN/docs/data-table/data-partition#%E5%88%86%E5%8C%BA%E5%92%8C%E5%88%86%E6%A1%B6:~:text=%E5%85%B3%E4%BA%8E%20Partition%20%E5%92%8C%20Bucket%20%E7%9A%84%E6%95%B0%E9%87%8F%E5%92%8C%E6%95%B0%E6%8D%AE%E9%87%8F%E7%9A%84%E5%BB%BA%E8%AE%AE",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档-数据划分"),r("OutboundLink")],1)]),t._v(" "),r("li",[r("a",{attrs:{href:"https://doris.apache.org/zh-CN/docs/advanced/partition/dynamic-partition/",target:"_blank",rel:"noopener noreferrer"}},[t._v("动态分区文档"),r("OutboundLink")],1)])]),t._v(" "),r("h2",{attrs:{id:"字段设计"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#字段设计"}},[t._v("#")]),t._v(" 字段设计")]),t._v(" "),r("ul",[r("li",[t._v("float 存在小数精度丢失问题，推荐用 double or decimal")])]),t._v(" "),r("h2",{attrs:{id:"load-数据"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#load-数据"}},[t._v("#")]),t._v(" Load 数据")]),t._v(" "),r("ul",[r("li",[t._v("Broker Load 大量数据用这个方式")]),t._v(" "),r("li",[t._v("Spark Load")]),t._v(" "),r("li",[t._v("Stream Load(Spark Doris 用此方式)")]),t._v(" "),r("li",[t._v("S3 Load 支持各种云存储")])]),t._v(" "),r("p",[r("a",{attrs:{href:"https://doris.apache.org/zh-CN/docs/data-operate/import/import-way/broker-load-manual",target:"_blank",rel:"noopener noreferrer"}},[t._v("数据导入文档"),r("OutboundLink")],1)]),t._v(" "),r("h2",{attrs:{id:"索引"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#索引"}},[t._v("#")]),t._v(" 索引")]),t._v(" "),r("h3",{attrs:{id:"前缀索引"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#前缀索引"}},[t._v("#")]),t._v(" 前缀索引")]),t._v(" "),r("p",[t._v("aggregate key 和 unique 是排序存储的，在排序的基础上，将一行数据的前 36 个字节 作为这行数据的前缀索引。")]),t._v(" "),r("p",[t._v("所以选择 unique key 的时候，把小字段（例如 int ）放前面，可以极大地提高查询效率.")]),t._v(" "),r("p",[t._v("前缀索引的实现方式是稀疏索引，好处是节省索引空间，但是效率会比密集索引差一点")]),t._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://doris.apache.org/zh-CN/docs/data-table/index/prefix-index",target:"_blank",rel:"noopener noreferrer"}},[t._v("前缀索引-官方文档"),r("OutboundLink")],1)]),t._v(" "),r("li",[r("a",{attrs:{href:"https://juejin.cn/post/6956421181465427981",target:"_blank",rel:"noopener noreferrer"}},[t._v("密集索引和稀疏索引"),r("OutboundLink")],1)])]),t._v(" "),r("h3",{attrs:{id:"bloomfilter-索引"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#bloomfilter-索引"}},[t._v("#")]),t._v(" BloomFilter 索引")]),t._v(" "),r("p",[t._v("适合高基列，数据几乎不重复的列，例如 userId/from_address/to_address")]),t._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://doris.apache.org/zh-CN/docs/data-table/index/bloomfilter",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档-BloomFilter索引"),r("OutboundLink")],1)]),t._v(" "),r("li",[r("a",{attrs:{href:"http://oserror.com/backend/bloomfilter/",target:"_blank",rel:"noopener noreferrer"}},[t._v("BloomFilter 原理"),r("OutboundLink")],1)])]),t._v(" "),r("h3",{attrs:{id:"bitmap-索引"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#bitmap-索引"}},[t._v("#")]),t._v(" Bitmap 索引")]),t._v(" "),r("p",[t._v("适合低基列，字段内容只有固定几个值的，例如 age，gender")]),t._v(" "),r("p",[r("a",{attrs:{href:"https://www.cnblogs.com/lbser/p/3322630.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("位图索引原理"),r("OutboundLink")],1)]),t._v(" "),r("h3",{attrs:{id:"rollup"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#rollup"}},[t._v("#")]),t._v(" Rollup")]),t._v(" "),r("p",[t._v("把热门查询的几个列独立到一张表中，提高查询速度")]),t._v(" "),r("p",[t._v("可以用 Rollup 调整前缀索引顺序")]),t._v(" "),r("p",[r("a",{attrs:{href:"https://doris.apache.org/zh-CN/docs/data-table/hit-the-rollup",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档-Rollup"),r("OutboundLink")],1)]),t._v(" "),r("h2",{attrs:{id:"profile"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#profile"}},[t._v("#")]),t._v(" Profile")]),t._v(" "),r("h3",{attrs:{id:"explain-查询计划"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#explain-查询计划"}},[t._v("#")]),t._v(" Explain 查询计划")]),t._v(" "),r("p",[t._v("实例分析")]),t._v(" "),r("h3",{attrs:{id:"profile-记录分析"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#profile-记录分析"}},[t._v("#")]),t._v(" Profile 记录分析")]),t._v(" "),r("h2",{attrs:{id:"缓存"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#缓存"}},[t._v("#")]),t._v(" 缓存")]),t._v(" "),r("h3",{attrs:{id:"分区缓存"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#分区缓存"}},[t._v("#")]),t._v(" 分区缓存")]),t._v(" "),r("p",[t._v("TBD")]),t._v(" "),r("h2",{attrs:{id:"其他"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#其他"}},[t._v("#")]),t._v(" 其他")]),t._v(" "),r("h3",{attrs:{id:"doris-官方-apache-doris-性能优化原理篇"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#doris-官方-apache-doris-性能优化原理篇"}},[t._v("#")]),t._v(" Doris 官方：Apache Doris 性能优化原理篇")]),t._v(" "),r("p",[t._v("时间换空间：建索引，加缓存，适合固定查询场景")]),t._v(" "),r("p",[t._v("数据剪裁：谓词下推/Join-Reorder，适合即席查询")]),t._v(" "),r("p",[r("a",{attrs:{href:"https://mp.weixin.qq.com/s/EMcBr_bSkY0QbfYKnLGI-g",target:"_blank",rel:"noopener noreferrer"}},[t._v("PPT 回顾"),r("OutboundLink")],1)])])}),[],!1,null,null,null);r.default=s.exports}}]);