(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{615:function(s,t,e){"use strict";e.r(t);var a=e(2),n=Object(a.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"在-node-里使用使用-this-的问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在-node-里使用使用-this-的问题"}},[s._v("#")]),s._v(" 在 Node 里使用使用 this 的问题")]),s._v(" "),t("h2",{attrs:{id:"this-指向不正确"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#this-指向不正确"}},[s._v("#")]),s._v(" this 指向不正确")]),s._v(" "),t("p",[s._v("Node 在 ES2016 里引入了 Class，终于不用使用 function 来模拟 class 了，最近在使用 Class 的时候碰到个关于 this 指向的小问题，记录下。")]),s._v(" "),t("p",[s._v("来看一段代码，两个文件：")]),s._v(" "),t("p",[s._v("test_a.js")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("const test_b = require('./test_b')const funcs = {  func_a: test_b.func_a}funcs.func_a()\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("test_b.js")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("'use strict';class B {  func_a() {    console.log(\"I'm func_a\");    this.func_b()  }  func_b() {    console.log(\"I'm func_b\");  }}module.exports = new B()\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("执行 test_a,js，会报错")]),s._v(" "),t("blockquote",[t("p",[s._v("/usr/local/bin/node test_a.js I’m func_a")]),s._v(" "),t("p",[s._v("/Users/nick/nodePro/fin_base/api/models/test_b.js:5")]),s._v(" "),t("p",[s._v("this.func_b()")]),s._v(" "),t("p",[s._v("^")]),s._v(" "),t("p",[s._v("TypeError: this.func_b is not a function")]),s._v(" "),t("p",[s._v("at Object.func_a (/Users/nick/nodePro/fin_base/api/models/test_b.js:5:10)")]),s._v(" "),t("p",[s._v("at Object. (/Users/nick/nodePro/fin_base/api/models/test_a.js:6:7)")]),s._v(" "),t("p",[s._v("at Module._compile (module.js:409:26)")])]),s._v(" "),t("h2",{attrs:{id:"原因分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#原因分析"}},[s._v("#")]),s._v(" 原因分析")]),s._v(" "),t("p",[s._v("因为在把 func_a 赋值给 funcs 后，func_a 里的 this 指向的的是 test_a 文件里的 "),t("strong",[s._v("funcs")]),s._v(" 对象，而不是我们要预期的执行 test_b 文件里的 class B 实例。")]),s._v(" "),t("p",[s._v("所以我们把赋值的代码稍微改一下：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("func_a: function () {  return test_b.func_a()}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("这样就可以了，如果要要传递参数，可以写成这样：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("func_a: function () {  return test_b.func_a.apply(test_b, arguments)}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])}),[],!1,null,null,null);t.default=n.exports}}]);